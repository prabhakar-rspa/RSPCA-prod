<aura:component
  controller="RenewMembership"
  implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader"
  access="global"
>
  <aura:attribute name="site" type="Account" />
  <aura:attribute name="agreement" type="boolean" default="false" />
  <aura:attribute name="noOffences" type="boolean" default="false" />
  <aura:attribute name="recordLoadError" type="String" />
  <aura:attribute name="isLoading" type="boolean" default="false" />
  <aura:attribute name="options" type="List" />
  <aura:attribute name="selectedValue" type="String" default="" />
  <aura:attribute name="contactId" type="string" />
  <aura:attribute name="contactName" type="string" default="" />
  <aura:attribute name="today" type="Date" default="" />
  <aura:attribute name="UnitRecords" type="List" />

  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

  <force:recordData
    aura:id="recordLoader"
    recordId="{!v.recordId}"
    fields="Id,Name, Primary_Contact__c, Status__c"
    targetFields="{!v.site}"
    targetError="{!v.recordLoadError}"
  />
  <section
    role="dialog"
    aria-labelledby="modal-heading-01"
    aria-modal="true"
    aria-describedby="modal-content-id-1"
    class="slds-modal slds-fade-in-open slds-modal_medium"
  >
    <div class="slds-modal__container">
      <!-- Header -->
      <header class="slds-modal__header">
        <h2
          id="modal-heading-01"
          class="slds-text-heading_medium slds-hyphenate"
          >Renew Membership: {!v.site.Name}</h2
        >
      </header>

      <!-- body -->
      <div
        class="slds-modal__content slds-p-around_medium .slds-is-relative"
        id="modal-content-id-1"
      >
        <aura:if isTrue="{!v.isLoading}">
          <div class="slds-spinner_container">
            <lightning:spinner alternativeText="Loading" size="medium" />
          </div>
        </aura:if>
        <div>
          <div class="row">
            <aura:if isTrue="{!v.site.Status__c ==  'CANCELLED'}">
              <p>Status: <strong style="color: red;">{!v.site.Status__c}</strong></p>
              <br/>
            </aura:if>
            <p
              >To renew your membership please check the boxes to confirm which
              units you wish to renew and agree to the terms and conditions,
              then click on the 'Pay' button below.</p
            >
            <br />
          </div>

          <!-- list of units -->
          <div class="slds-m-around_x-small">
            <table
              class="slds-table slds-table_bordered slds-table_striped slds-table_cell-buffer slds-table_fixed-layout"
            >
              <thead>
                <tr class="slds-text-heading_label">
                  <th scope="col">
                    <div class="slds-truncate" title="Select">Select</div>
                  </th>
                  <th scope="col">
                    <div class="slds-truncate" title="Unit Number"
                      >Unit Number</div
                    >
                  </th>
                  <th scope="col">
                    <div class="slds-truncate" title="Description"
                      >Description</div
                    >
                  </th>
                </tr>
              </thead>

              <tbody>
                <!-- Iterate all child record list in table format -->
                <aura:iteration items="{!v.UnitRecords}" var="u">
                  <tr>
                    <td>
                      <ui:inputCheckbox aura:id="checkBox" text="{!u.Id}" />
                    </td>
                    <td>
                      <div class="slds-truncate" title="{!u.Name}"
                        >{!u.Name}</div
                      >
                    </td>
                    <td>
                      <div class="slds-truncate" title="{!u.Description__c}"
                        >{!u.Description__c}</div
                      >
                    </td>
                  </tr>
                </aura:iteration>
              </tbody>
            </table>
          </div>
          <br />
          <br />

          <div class="slds-section slds-is-open">
            <h3 class="slds-section__title slds-theme_shade">
              <span
                class="slds-truncate slds-p-horizontal_small"
                title="Section Title"
                >Payment Information</span
              >
            </h3>
            <div aria-hidden="false" class="slds-section__content">
              <div class="row">
                <lightning:select
                  aura:id="fieldId"
                  name="mySelect"
                  label="Payment Method:"
                  value="{!v.selectedValue}"
                  required="true"
                  messageWhenValueMissing="Please select a payment method"
                >
                  <aura:iteration items="{!v.options}" var="item">
                    <option
                      text="{!item.label}"
                      value="{!item.value}"
                      selected="{!item.selected}"
                    />
                  </aura:iteration>
                </lightning:select>
              </div>
            </div>
          </div>
          <br />
          <div class="slds-section slds-is-open">
            <h3 class="slds-section__title slds-theme_shade">
              <span
                class="slds-truncate slds-p-horizontal_small"
                title="Section Title"
                >Legal Information</span
              >
            </h3>
            <div aria-hidden="false" class="slds-section__content">
              <div class="row">
                <lightning:input
                  aura:id="fieldId"
                  type="checkbox"
                  checked="{!v.agreement}"
                  required="true"
                  label="I have read and agree to the terms of the RSPCA Assured membership agreement and SCI Certification UK scheme regulations."
                /><br />
                <lightning:input
                  aura:id="fieldId"
                  type="checkbox"
                  checked="{!v.noOffences}"
                  required="true"
                  label="I confirm that I do not have any previous convictions or pending prosecutions relating to any offence involving the care, handling, transport, slaughter or sale of animals or produce."
                />
                <br />
                <br />
                <br />

                <div style="width:100%;display:table;">
                  <div style="display:table-row">
                    <div style="width:50%;display:table-cell">
                      <lightning:input
                        aura:id="fieldId"
                        label="Signatory Name:"
                        type="text"
                        value="{!v.contactName}"
                        readonly="true"
                        required="true"
                        messageWhenValueMissing="Please enter a primary contact for the site."
                      />
                    </div>
                    <div style="display:table-cell;">
                      <p>Signed Date:</p>
                      <ui:outputDate value="{!v.today}" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br />
        </div>
      </div>
      <!-- Footer -->
      <lightning:navigation aura:id="navService" />
      <footer class="slds-modal__footer">
        <ui:button
          class="slds-button slds-button_neutral"
          label="Cancel"
          press="{!c.handleCancel}"
        />
        <aura:if isTrue="{!v.site.Status__c !=  'CANCELLED'}">
          <lightning:button
            class="slds-button slds-button_brand"
            label="Renew Application"
            onclick="{!c.handleRenew}"
          />
        </aura:if>
      </footer>
    </div>
  </section>
</aura:component>